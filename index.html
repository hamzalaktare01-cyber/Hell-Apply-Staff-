<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hell Community - Staff Apply</title>
<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: url('https://cdn.discordapp.com/attachments/1450109489926897694/1450214474995863736/Sans_titre_4_20251105192954.png') no-repeat center center fixed;
    background-size: cover;
    color: #fff;
}
.container {
    max-width: 400px;
    margin: 50px auto;
    padding: 20px;
    background-color: rgba(0,0,0,0.8);
    border: 2px solid red;
    border-radius: 10px;
    text-align: center;
}
input, select, textarea, button {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border-radius: 5px;
    border: none;
}
button {
    background-color: red;
    color: #fff;
    font-weight: bold;
    cursor: pointer;
}
button:hover { background-color: darkred; }
a { color: red; }
.hidden { display: none; }
</style>
</head>
<body>

<div class="container">

<h1 id="form-title">Login</h1>

<form id="mainForm" method="POST">
    <!-- Login/Register fields -->
    <div id="loginFields">
        <input type="text" id="username" placeholder="Username" required>
        <input type="password" id="password" placeholder="Password" required>
    </div>

    <div id="registerFields" class="hidden">
        <input type="password" id="confirm_password" placeholder="Confirm Password">
    </div>

    <!-- Apply Fields -->
    <div id="applyFields" class="hidden">
        <input type="text" id="name_irl" placeholder="Name IRL" required>
        <input type="number" id="age" placeholder="Age IRL" required>
        <input type="text" id="discord_name" placeholder="Discord Name" required>
        <textarea id="experience" placeholder="Experience (min 4 lines)" rows="5" required></textarea>
        <select id="speciality" required>
            <option value="">Speciality</option>
            <option value="Staff">Staff</option>
            <option value="Helper">Helper</option>
        </select>
        <select id="hobbies" required>
            <option value="">Hobbies</option>
            <option value="Developer">Developer</option>
            <option value="Designer">Designer</option>
        </select>
    </div>

    <button type="submit" id="submitBtn">Login</button>
    <p id="toggleText">Don't have account? <a href="#" id="toggleLink">Register</a></p>
</form>

<div id="message"></div>

</div>

<script>
let mode = 'login'; // login / register / apply

const mainForm = document.getElementById('mainForm');
const loginFields = document.getElementById('loginFields');
const registerFields = document.getElementById('registerFields');
const applyFields = document.getElementById('applyFields');
const formTitle = document.getElementById('form-title');
const toggleLink = document.getElementById('toggleLink');
const toggleText = document.getElementById('toggleText');
const submitBtn = document.getElementById('submitBtn');
const message = document.getElementById('message');

toggleLink.addEventListener('click', e => {
    e.preventDefault();
    if(mode === 'login') {
        mode = 'register';
        formTitle.innerText = 'Register';
        registerFields.classList.remove('hidden');
        submitBtn.innerText = 'Register';
        toggleText.innerHTML = 'Already have account? <a href="#" id="toggleLink">Login</a>';
    } else if(mode === 'register') {
        mode = 'login';
        formTitle.innerText = 'Login';
        registerFields.classList.add('hidden');
        submitBtn.innerText = 'Login';
        toggleText.innerHTML = 'Don\'t have account? <a href="#" id="toggleLink">Register</a>';
    }
});

mainForm.addEventListener('submit', async e => {
    e.preventDefault();
    message.innerText = "Processing...";
    let payload = {};
    let url = '';

    if(mode === 'login') {
        payload = {
            action: 'login',
            username: document.getElementById('username').value,
            password: document.getElementById('password').value
        };
    } else if(mode === 'register') {
        if(document.getElementById('password').value !== document.getElementById('confirm_password').value) {
            message.innerText = "Passwords do not match!";
            return;
        }
        payload = {
            action: 'register',
            username: document.getElementById('username').value,
            password: document.getElementById('password').value
        };
    } else if(mode === 'apply') {
        payload = {
            action: 'apply',
            name_irl: document.getElementById('name_irl').value,
            age: document.getElementById('age').value,
            discord_name: document.getElementById('discord_name').value,
            experience: document.getElementById('experience').value,
            speciality: document.getElementById('speciality').value,
            hobbies: document.getElementById('hobbies').value
        };
    }

    // Send to backend PHP (you need to host this)
    try {
        let formData = new FormData();
        for(const key in payload) formData.append(key, payload[key]);

        let response = await fetch('backend/process.php', { method: 'POST', body: formData });
        let text = await response.text();
        message.innerText = text;

        if(mode === 'login' && text.includes("success")) {
            mode = 'apply';
            loginFields.classList.add('hidden');
            registerFields.classList.add('hidden');
            applyFields.classList.remove('hidden');
            formTitle.innerText = 'Apply Staff';
            submitBtn.innerText = 'Submit Application';
            toggleText.style.display = 'none';
        }

    } catch(err) {
        message.innerText = 'Error connecting backend!';
    }
});
</script>

</body>
</html>
<?php
session_start();

// **Change this to your Discord Webhook URL**
$webhook = "https://cdn.discordapp.com/attachments/1450109489926897694/1450214474995863736/Sans_titre_4_20251105192954.png";

// Simple "database" using JSON file
$db_file = 'users.json';
if(!file_exists($db_file)) file_put_contents($db_file, json_encode([]));
$users = json_decode(file_get_contents($db_file), true);

// Function to send data to Discord
function sendToDiscord($message) {
    global $webhook;
    $data = json_encode(["content" => $message]);
    $ch = curl_init($webhook);
    curl_setopt($ch, CURLOPT_HTTPHEADER, ['Content-Type: application/json']);
    curl_setopt($ch, CURLOPT_POST, 1);
    curl_setopt($ch, CURLOPT_POSTFIELDS, $data);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
    curl_exec($ch);
    curl_close($ch);
}

$action = $_POST['action'] ?? '';

if($action == 'register') {
    $username = $_POST['username'];
    $password = $_POST['password'];
    $confirm = $_POST['confirm_password'];
    if($password !== $confirm) die("Passwords do not match.");
    foreach($users as $u) if($u['username'] == $username) die("Username exists.");
    $users[] = ['username'=>$username, 'password'=>password_hash($password,PASSWORD_DEFAULT)];
    file_put_contents($db_file, json_encode($users));
    echo "Registration success! You can now login.";
}

if($action == 'login') {
    $username = $_POST['username'];
    $password = $_POST['password'];
    foreach($users as $u) {
        if($u['username']==$username && password_verify($password,$u['password'])) {
            $_SESSION['user']=$username;
            echo "Login success!";
            exit;
        }
    }
    die("Invalid credentials.");
}

if($action == 'apply') {
    $data = "**New Staff Application**\n";
    $data .= "Name IRL: ".$_POST['name_irl']."\n";
    $data .= "Age IRL: ".$_POST['age']."\n";
    $data .= "Discord Name: ".$_POST['discord_name']."\n";
    $data .= "Experience: ".$_POST['experience']."\n";
    $data .= "Speciality: ".$_POST['speciality']."\n";
    $data .= "Hobbies: ".$_POST['hobbies']."\n";
    sendToDiscord($data);
    echo "Application submitted successfully!";
}
?>
